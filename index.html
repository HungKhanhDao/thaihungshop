<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thái Hưng Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <script src="https://kit.fontawesome.com/98638255fc.js" crossorigin="anonymous"></script>
    <style>
        #myBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: rgb(0, 0, 0);
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 10px;
            font-size: 10px;
        }

        #myBtn:hover {
            background-color: #ffffff;
            color: black;
        }

        .slides {
            width: 180vh;
            height: 120vh;
        }

        .carousel-center {
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body>
    <!-- Scroll to top -->
    <button onclick="topFunction()" id="myBtn" title="Go to top">&#10595</button>

    <nav class="navbar navbar-expand-lg bg-dark" data-bs-theme="dark">
        <div class="container p-3">
            <a class="navbar-brand" href="#">Thái Hưng Shop</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                </ul>
                <div class="d-flex justify-content-center align-items-center" id="auth-frame">
                    <button type="button" class="btn btn-primary mx-1" data-bs-toggle="modal" data-bs-target="#login">
                        Đăng nhập
                    </button>
                    <button type="button" class="btn btn-success mx-1" data-bs-toggle="modal"
                        data-bs-target="#register">
                        Đăng ký
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <div class="modal fade" id="login" tabindex="-1" aria-labelledby="loginTitle" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="loginTitle">Đăng nhập</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group mb-3">
                        <label>Tên đăng nhập</label>
                        <input type="text" id="username-login" class="form-control" required />
                    </div>
                    <div class="form-group mb-3">
                        <label>Mật khẩu</label>
                        <input type="password" id="password-login" class="form-control" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="loginUser()">Đăng nhập</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="register" tabindex="-1" aria-labelledby="registerTitle" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="registerTitle">Đăng ký</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group mb-3">
                        <label>Tên đăng nhập</label>
                        <input type="text" id="username-register" class="form-control" required />
                    </div>
                    <div class="form-group mb-3">
                        <label>Mật khẩu</label>
                        <input type="password" id="password-register" class="form-control" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="registerUser()">Đăng ký</button>
                </div>
            </div>
        </div>
    </div>
    <div class="offcanvas offcanvas-end" tabindex="-1" id="cart" aria-labelledby="cartLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="cartLabel">Giỏ hàng <p id="total" class="fw-semibold text-success"></p>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div id="cartBody" class="row row-cols-2"></div>
            <button class="btn btn-success w-100">Thanh toán</button>
        </div>
    </div>
    <div class="container m-auto mt-5">
        <div class="text-center">
            <h3 class="fw-semibold">Thái Hưng Shop</h3>
            <p class="fw-semibold text-secondary">Cung cấp những loại rượu hảo hạng nhất với chất lượng cao.</p>
        </div>
    </div>

    <!-- Carousel -->
    <div class="carousel-center">
        <div id="home" class="carousel">
            <img class="slides"
                src="https://images.immediate.co.uk/production/volatile/sites/30/2022/06/Tequila-sunrise-fb8b3ab.jpg?quality=90&resize=556,505">
            <img class="slides"
                src="https://www.foodandwine.com/thmb/tmfiRw9s9-Qf5BW1TlDAa4l8GRw=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/paloma-FT-RECIPE0621-6a7bbb9c70aa42cd82d9850acddd1f8b.jpg">
            <img class="slides"
                src="https://www.marthastewart.com/thmb/HME8jbqczrA7eDC0AkEJeOv43oA=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/image-20d47e14c4b14b7e9b1cf36f36721dd4-horiz-21c6a71e36ed4a26ba5bcfd914649970.jpg">
            <script>
                w3.slideshow(".slides", 1500);
            </script>
        </div>
    </div>

    <div id="items" class="container m-auto mt-4 row row-cols-3 d-flex justify-content-center align-items-center">
        <div class="text-center">
            <div class="spinner-grow m-auto" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p>Đang tải</p>
        </div>
    </div>

    <div class="">
        <footer class="py-3 my-4">
            <ul class="nav justify-content-center border-bottom pb-3 mb-3">
                <li class="nav-item"><a href="/test/index.html" class="nav-link px-2 text-muted">Home</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Pricing</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
            </ul>
            <p class="text-center text-muted">© 2024 Company, since 1968</p>
        </footer>
    </div>
    <script>
        // Get the button:
        let mybutton = document.getElementById("myBtn");

        // When the user scrolls down 20px from the top of the document, show the button
        window.onscroll = function () {
            scrollFunction();
        };

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                mybutton.style.display = "block";
            } else {
                mybutton.style.display = "none";
            }
        }

        // When the user clicks on the button, scroll to the top of the document
        function topFunction() {
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
        }

        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'VND',
        });
        function getRandomInt(min, max) {
            const minCeiled = Math.ceil(min);
            const maxFloored = Math.floor(max);
            return Math.floor(Math.random() * (maxFloored - minCeiled) + minCeiled);
        }

        // Create a blank cart if there are no items
        if (localStorage.getItem('cart') === null) {
            localStorage.setItem('cart', JSON.stringify({ "items": [] }));
        }

        // Cart List
        const cartList = document.getElementById('cartBody');
        const cart = JSON.parse(localStorage.getItem('cart'));
        const cartItemsCount = cart.items.length;
        if (cart.items.length > 0) {
            let total = 0;
            cart.items.forEach((e) => {
                total += e.price;
            })
            document.getElementById('total').innerText = formatter.format(total);
        }

        cart.items.forEach((e) => {
            cartList.innerHTML += `
            <div class="card p-3 border-0 mb-3">
                <img src="${e.itemThumb}" class="card-img-top">
                <div class="card-body">
                    <p class="card-title fs-4">${e.itemName}</p>    
                    <p class="text-success fw-semibold">${e.price} VND</p>
                    <button onclick="removeFromCart(${e.intId})" class="btn btn-danger">Xóa khỏi giỏ hàng</button>
                </div> 
            </div>  
            `
        })

        // Check if user is logged in
        if (localStorage.getItem('currentUser') !== null) {
            document.getElementById('auth-frame').innerHTML = `
            <p class="fw-semibold text-white m-0 mx-1">Chào mừng trở lại, ${localStorage.getItem('currentUser')}</p>
            <button class="btn btn-primary mx-1" type="button" data-bs-toggle="offcanvas" data-bs-target="#cart" aria-controls="cart">
                Giỏ hàng <span class="badge bg-secondary">${cartItemsCount}</span>
            </button>
            <button onclick="logout()" class="btn btn-danger">Đăng xuất</button>
            `;
        }

        // Fetch random alcohols
        axios.get('https://www.thecocktaildb.com/api/json/v1/1/filter.php?g=Cocktail_glass')
            .then((res) => {
                const itemIndex = document.getElementById('items');
                itemIndex.innerHTML = "";
                let count = 0;
                res.data['drinks'].every((i) => {
                    if (count <= 20) {
                        const randomPrice = formatter.format(getRandomInt(100000, 1000000));
                        itemIndex.innerHTML += `
                    <div class="col p-3">
                        <div class="card border shadow-sm">
                            <img src="${i.strDrinkThumb}" class="card-img-top">
                            <div class="card-body">
                                <p class="card-title fs-4">${i.strDrink}</p>
                                <p class="text-success fw-semibold">${randomPrice} VND</p>
                                <button onclick="addToCart('${i.idDrink}', '${randomPrice}')" class="btn btn-primary">Thêm vào giỏ hàng</button>       
                            </div> 
                        </div>    
                    </div>
                    `
                        count += 1;
                        return true;
                    } else {
                        return false;
                    }
                })
            })

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.reload();
        }

        function loginUser() {
            const username = document.getElementById('username-login').value;
            const password = document.getElementById('password-login').value;
            console.log(localStorage.getItem(username));
            if (localStorage.getItem(username) === password) {
                localStorage.setItem('currentUser', username);
                console.log(localStorage.getItem(username));
                alert("Đăng nhập thành công");
                window.location.reload();
            } else {
                alert("Sai tên đăng nhập hoặc mật khẩu");
            }
        }

        function registerUser() {
            const username = document.getElementById('username-register').value;
            const password = document.getElementById('password-register').value;

            if (localStorage.getItem(username) !== null) {
                alert("Đã có người dùng khác dùng username này");
                username = "";
                password = "";
            } else {
                localStorage.setItem(username, password);
                localStorage.setItem('currentUser', username);
                alert("Đăng ký thành công");
                window.location.reload();
            }
        }

        function addToCart(id, randomPrice) {
            axios.get(`https://www.thecocktaildb.com/api/json/v1/1/lookup.php?i=${id}`)
                .then((res) => {
                    let currentCart = JSON.parse(localStorage.getItem('cart'));
                    currentCart.items.push({
                        "itemId": id,
                        "itemName": res.data.drinks[0].strDrink,
                        "itemThumb": res.data.drinks[0].strDrinkThumb,
                        "price": Number(randomPrice.replace(/[^0-9.-]+/g, ""))
                    })
                    localStorage.setItem('cart', JSON.stringify(currentCart));
                    alert("Đã thêm vào giỏ");
                    window.location.reload();
                })
        }

        function removeFromCart(id) {
            cart.items.splice(id, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            alert("Đã xóa khỏi giỏ");
            window.location.reload();
        }
    </script>
</body>

</html>
